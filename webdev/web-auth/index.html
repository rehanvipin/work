<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.145.0">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Authentication in web services
  #

How does an application figure out who is talking to it? What part of the identity of that person / system is enough?
e-mails &amp; passwords are one way. WebAuthn is another.
kerberos is a good option inside an enterprise. it provides a convenient SSO experience when combined with SPNEGO.
session tokens passed on as cookies can also work depending on the use case.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:url" content="https://work.rehanvipin.me/webdev/web-auth/">
  <meta property="og:site_name" content="Field Manual">
  <meta property="og:title" content="Web Authentication">
  <meta property="og:description" content="Authentication in web services # How does an application figure out who is talking to it? What part of the identity of that person / system is enough?
e-mails &amp; passwords are one way. WebAuthn is another. kerberos is a good option inside an enterprise. it provides a convenient SSO experience when combined with SPNEGO. session tokens passed on as cookies can also work depending on the use case.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="webdev">
<title>Web Authentication | Field Manual</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.ece3f56fc3f716f87ccd4e6f3ea44ba1fa6757114261dadfbf861fde7d4e6203.css" integrity="sha256-7OP1b8P3Fvh8zU5vPqRLofpnVxFCYdrfv4Yf3n1OYgM=">
<script defer src="/en.search.min.b24fa6f04197fb8a84af4801b873738aa81dc4250740d42b4b3ccb5aa1d0b210.js" integrity="sha256-sk&#43;m8EGX&#43;4qEr0gBuHNziqgdxCUHQNQrSzzLWqHQshA="></script>

<script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/favicon.png" alt="Logo" /><span>Field Manual</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-d938590ca2412dffddd407c9492deb06" class="toggle"  />
    <label for="section-d938590ca2412dffddd407c9492deb06" class="flex justify-between">
      <a href="https://work.rehanvipin.me/angular/" class="">Angular</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/components/" class="">Components</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/template/" class="">Template Syntax</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/services/" class="">Services</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/directives/" class="">Directives</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/routing/" class="">Routing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/forms/" class="">Forms</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/pipes/" class="">Pipes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/di/" class="">Dependency Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/rxjs/" class="">RxJS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/test/" class="">Testing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/libraries/" class="">Libraries</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/signals/" class="">Reactivity with Signals</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-c38691ce03cec66ff0f7b7efaab53e79" class="toggle"  />
    <label for="section-c38691ce03cec66ff0f7b7efaab53e79" class="flex justify-between">
      <a href="https://work.rehanvipin.me/spring-boot/" class="">Spring Boot</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/spring-boot/framework/" class="">Spring Framework</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-ce5ff98c33c145e8b67581715b2547e5" class="toggle"  />
    <label for="section-ce5ff98c33c145e8b67581715b2547e5" class="flex justify-between">
      <a href="https://work.rehanvipin.me/java/" class="">Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/java/intro/" class="">Setup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/java/modules/" class="">Mods &amp; Packs</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/java/jvm/" class="">JVM</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/java/build_tools/" class="">Build tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/java/web-server/" class="">Web Server</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-e0492fb7d644f53d646814ca03b395ed" class="toggle"  />
    <label for="section-e0492fb7d644f53d646814ca03b395ed" class="flex justify-between">
      <a href="https://work.rehanvipin.me/linux/" class="">Linux stuff</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-773d618b842553ceefdcb3472b44e38d" class="toggle" checked />
    <label for="section-773d618b842553ceefdcb3472b44e38d" class="flex justify-between">
      <a  class="">Web Development</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/html/" class="">HTML</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/css/" class="">CSS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/js/" class="">JS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/js-execution/" class="">JavaScript Execution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/web-app-arch/" class="">Web App Architecture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/web-auth/" class=" active">Web Authentication</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/webdev/react-and-bootstrap/" class="">React &amp; Boostrap</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Fun Stuff</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/misc/d3/" class="">D3</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/misc/typescript/" class="">Typescript</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/misc/tips-tricks/" class="">Tips &amp; Tricks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/misc/snowflake/" class="">Snowflake</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/tmp/" class="">/tmp</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/whatnext/" class="">/next</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/credits/" class="">/credits</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Web Authentication</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#authentication-in-web-services">Authentication in web services</a>
      <ul>
        <li><a href="#oidc">OIDC</a></li>
        <li><a href="#jwt">JWT</a></li>
        <li><a href="#saml">SAML</a></li>
        <li><a href="#faqs">FAQs</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="authentication-in-web-services">
  Authentication in web services
  <a class="anchor" href="#authentication-in-web-services">#</a>
</h1>
<p>How does an application figure out who is talking to it? What part of the identity of that person / system is enough?</p>
<p>e-mails &amp; passwords are one way. WebAuthn is another.
kerberos is a good option inside an enterprise. it provides a convenient SSO experience when combined with SPNEGO.
session tokens passed on as cookies can also work depending on the use case.</p>
<p>I&rsquo;m gonna look at some relatively modern ones.
Note that unlike the above, these aren&rsquo;t cryptographic protocols. In the end they still use one of the above ways to authenticate the user at some point.</p>
<h2 id="oidc">
  OIDC
  <a class="anchor" href="#oidc">#</a>
</h2>
<p>OAuth 2.0 is the main thing. OIDC is just a standard way to do authentication with OAuth. Else ppl were making their own implementaitons.<br>
OAuth 2.0 itself is an authorization protocol to provide one app (e.g., App A) access to a user&rsquo;s resources in another app (e.g., App B), after authenticating the user &amp; getting their consent via an authorization server.
In the case of OIDC, the App A also gets an ID card of the user along with the access token of App B.<br>
That ID card is sent as a JWT (JSON Web Token), which is a format.
The authorization server could be App B itself, or another service that it trusts.</p>
<p>The flow is like this (one of many OAuth 2.0 &ldquo;flows&rdquo;. this one is the web server flow):</p>
<ul>
<li>User wants to login to App A</li>
<li>They click on a &ldquo;login with App B&rdquo; button on the App A</li>
<li>App A redirects user to the authorization server for App B (the resource server)</li>
<li>The authorization server checks whether the user has logged into App B, or if not, asks them to log in</li>
<li>The authorization server checks whether the user provides their consent</li>
<li>User is redirected to App A, which now has an authorization code</li>
<li>App A asks for an access token &amp; ID token from authz server. this happens in App A&rsquo;s backend server.
the access token will be used to talk to App B and it is supposed to be a SECRET!
ID token is a JWT which is like an ID Card of the user. JWT is just encoded and not encrypted. it is signed though.</li>
<li>App A now knows who the user is, as per the users records in App B&rsquo;s system</li>
<li>App A can talk to App B via it&rsquo;s backend server, on behalf of the user, as per the scope of the access token</li>
</ul>
<p>Tech jargon:</p>
<ul>
<li>client id &amp; client secret which App A (the client) uses to talk to the authorization server. doesn&rsquo;t involve the user</li>
<li>callback URL / redirect URI, provided by App A. it is the URI that authorization server should redirect user to, if consent granted</li>
<li>response type. what kinda response the client wants to get after authz server gets the user&rsquo;s consent</li>
<li>authorization code. the default response type. this is a not-so-secret string that the App A will use for comms
with the authorization server when talking about that particular user. it&rsquo;s like a session cookie.
the authz server will only accept if it is accompanied with a client secret.</li>
<li>JWT. the ID token of a particular user that authorization server sends to App A
as a response when it sends the request along with the authorization code.</li>
<li>registeration. when the client sets up an account with the authz server. it needs to give a redirect_uri &amp; some details. gets a client id, secret.</li>
</ul>
<p>if App A runs entirely on the client device, e.g., PWA / Mobile App, then they can&rsquo;t use the client secret, since it will be exposed to the user / public.
in such cases, there&rsquo;s a PKCE flow which can be used.</p>
<p>there&rsquo;s also an Implicit flow for such devices, where instead of authz server sending an authorization code, it just sends the access token directly.
however, this is a bit risky, since a secret is now on the client&rsquo;s device. it should be stored safely, e.g., via a httpOnly cookie.</p>
<p>there&rsquo;s a client credentials flow which doesn&rsquo;t involve the user at all, and used for system to system communication only.</p>
<p>there&rsquo;s a device flow for cases where user isn&rsquo;t able to interact on a device to provide their consent. e.g., a terminal.<br>
in such cases, the device will ask user to open a link and type in a code to do the authorization grant with the authorization server.</p>
<p>OAuth 2.0 is a web standard. 
  <a href="https://www.rfc-editor.org/info/rfc6749">IETF RFC</a>, whereas OAuth 1.0 was just a name used by some libraries floating around in the initial days before the standard got developed.</p>
<p>OIDC is not a web standard (maybe it needn&rsquo;t have been), but they have a standard written on their site : 
  <a href="https://openid.net">https://openid.net</a></p>
<h2 id="jwt">
  JWT
  <a class="anchor" href="#jwt">#</a>
</h2>
<p>JSON Web Token? With such a generic name, it&rsquo;s sure sounds like trouble. But it&rsquo;s also a web standard :O 
  <a href="https://datatracker.ietf.org/doc/html/rfc7519">IETF RFC</a>.</p>
<p>It consists of three parts. Once the JSONs of all three are encoded, it becomes a URL safe string, with a &lsquo;.&rsquo; separating the three parts. the parts are:</p>
<ul>
<li>header. telling the subtype of token, algo used for signing etc.</li>
<li>body. whatever JSON. all custom data, including secrets and stuff go here. the stuff here is also known as &ldquo;claim(s)&rdquo;</li>
<li>signature. this is used to verify that the token was generated by the authorization service and not tampered with</li>
</ul>
<p>Once authenticated, the JWT is used to identify the client. Like a sessionID cookie. But unlike the cookie, the JWT has meaning when decoded &amp; can be decoded
to get info about the user, e.g., username, email, permissions etc. Once the server sends the JWT to the client, the client can send it along with every request
as part of the Authorization header. Because of the signature, the server knows the token isn&rsquo;t tampered with. It is also possible for the server to reject some
JWTs after an expiration period, or expire them if they suspect a leak.</p>
<p>Some websites also use a concept of <em>refresh token</em> which allows the access token to be refreshed frequently to reduce impacts of leaks.
A refresh token is has a longer expiry and can be used to refresh access tokens. What if a refresh token leaks? Yeah, it could.
It should be stored in a safer place. And like access tokens, they can be invalidated.</p>
<p>JWTs became popular since they contain info about the user,
that info can be used by the server for app logic instead of going to the DB to get info about the user who made the request.
That also means that a JWT from one server can be sent to another related server and that needn&rsquo;t re-authenticate the user. Not really possible with sessionIds.
However, this increases the request size if there&rsquo;s too much info being stored in the token.</p>
<p>Since it identifies a user, they should make sure to keep it secret. Should be treated at the same secrecy level as a password.</p>
<h2 id="saml">
  SAML
  <a class="anchor" href="#saml">#</a>
</h2>
<p>Is older than OAuth. Current version is SAML 2.0, but not actively being developed. Meant for SSO. It provides authentication and authorization.<br>
Frequently used in internal enterprise systems. Uses a central IdP (identity provider) which all services talk to.
Why would you ever use this? It&rsquo;s already used in multiple places. And the flow seems simpler than OAuth. However, OAuth is the preferred choice for new apps.</p>
<h2 id="faqs">
  FAQs
  <a class="anchor" href="#faqs">#</a>
</h2>
<p>These are questions that came up while I was exploring different posts / videos.</p>
<ol>
<li>
<p>Why is a refresh token required if the access token itself could be used to get new ones?
Uhh.. IDK. The claim is that a refresh token can be invalidated, but then so could access tokens.</p>
</li>
<li>
<p>Why provide a &ldquo;state&rdquo; param in the auth_code request?
If you want to give the redirect_uri of your site some data about the state of the app from which the user was sent to the authz server.
The other case is to prevent CSRF. Your site should be the able to determine if the state string indeed came from it.
Else, someone could make a auth URL which will then ask the user to login, consent &amp; send them to your site.</p>
</li>
</ol>
<p>more details: 
  <a href="https://stackoverflow.com/q/26132066/13229013">https://stackoverflow.com/q/26132066/13229013</a></p>
<ol start="3">
<li>What&rsquo;s the diff b/w state &amp; nonce?
state is for browser based flows whereas nonce is for the id token request.
to verify that the server is indeed returing a response to your request &amp; prevents replay attacks.
state could have some meaning encoded whereas nonce is a random number.</li>
</ol>
<p>still don&rsquo;t get it fully. nonce can inform a user of MiTM attack, but it can&rsquo;t really prevent it I guess.</p>
<p>more details: 
  <a href="https://stackoverflow.com/q/46844285/13229013">https://stackoverflow.com/q/46844285/13229013</a></p>
<ol start="4">
<li>Why does redirect_uri need to be part of the access token request?
This one is actually a topic of discussion. Some claim that it&rsquo;s not really useful.
Apparently, not registerting a static redirect_uri can lead to phishing attacks if someone creates a link to make authz server send users to a rogue site.
but that&rsquo;s only applicable for auth code requests. what about the access token request? which doesn&rsquo;t redirect.</li>
</ol>
<p>all this shouldn&rsquo;t happen when using the client secret.</p>
<p>more details: 
  <a href="https://stackoverflow.com/questions/37659188/why-is-redirect-uri-required-on-access-token-request">https://stackoverflow.com/questions/37659188/why-is-redirect-uri-required-on-access-token-request</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#authentication-in-web-services">Authentication in web services</a>
      <ul>
        <li><a href="#oidc">OIDC</a></li>
        <li><a href="#jwt">JWT</a></li>
        <li><a href="#saml">SAML</a></li>
        <li><a href="#faqs">FAQs</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>

</html>












