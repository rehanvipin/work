<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.99.1" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Unit &amp; Integrated tests #  Angular uses Jasmine for unit testing and Karma to run the tests on browsers. Tests can be:
Isolated #   Only tests the JS class not the component Mostly used for services and pipes Need to create instances of classes on your own   Integrated #   Tests the class and template together Mostly used for components and directives The objects are created by the framework    Unit tests #  They test a single unit (like a class, function, or a bunch of classes) in isolation.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Testing" />
<meta property="og:description" content="Unit &amp; Integrated tests #  Angular uses Jasmine for unit testing and Karma to run the tests on browsers. Tests can be:
Isolated #   Only tests the JS class not the component Mostly used for services and pipes Need to create instances of classes on your own   Integrated #   Tests the class and template together Mostly used for components and directives The objects are created by the framework    Unit tests #  They test a single unit (like a class, function, or a bunch of classes) in isolation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://work.rehanvipin.me/angular/test/" /><meta property="article:section" content="angular" />



<title>Testing | Field Manual</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.ece3f56fc3f716f87ccd4e6f3ea44ba1fa6757114261dadfbf861fde7d4e6203.css" integrity="sha256-7OP1b8P3Fvh8zU5vPqRLofpnVxFCYdrfv4Yf3n1OYgM=">
<script defer src="/en.search.min.316264761f7b1683ce46f192f027a465c2a5bf204b8a4883954b717389891427.js" integrity="sha256-MWJkdh97FoPORvGS8CekZcKlvyBLikiDlUtxc4mJFCc="></script>

<script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/favicon.png" alt="Logo" /><span>Field Manual</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-c029195c85e40978d9a8f4514856eec8" class="toggle" checked />
    <label for="section-c029195c85e40978d9a8f4514856eec8" class="flex justify-between">
      <a href="https://work.rehanvipin.me/angular/" class="">Angular</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/components/" class="">Components</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/template/" class="">Template Syntax</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/services/" class="">Services</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/directives/" class="">Directives</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/routing/" class="">Routing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/forms/" class="">Forms</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/pipes/" class="">Pipes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/di/" class="">Dependency Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/rxjs/" class="">RxJS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/test/" class=" active">Testing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/angular/libraries/" class="">Libraries</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="https://work.rehanvipin.me/front-end-stuff/" class="">Front-End</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/front-end-stuff/d3/" class="">D3</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/front-end-stuff/svg/" class="">SVG</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/stolenstuff/" class="">/tmp</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/whatnext/" class="">/next</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://work.rehanvipin.me/credits/" class="">/credits</a>
  

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Testing</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#unit--integrated-tests">Unit &amp; Integrated tests</a>
      <ul>
        <li><a href="#unit-tests">Unit tests</a>
          <ul>
            <li><a href="#mocking">Mocking</a></li>
          </ul>
        </li>
        <li><a href="#integrated-tests">Integrated tests</a>
          <ul>
            <li><a href="#setup">Setup</a></li>
            <li><a href="#deep--shallow-tests">Deep &amp; Shallow tests</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#debugging">Debugging</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="unit--integrated-tests">
  Unit &amp; Integrated tests
  <a class="anchor" href="#unit--integrated-tests">#</a>
</h1>
<p>Angular uses Jasmine for unit testing and Karma to run the tests on browsers. Tests can be:</p>
<div class="book-columns flex flex-wrap">
  
  <div class="flex-even markdown-inner">
    <h4 id="isolated">
  Isolated
  <a class="anchor" href="#isolated">#</a>
</h4>
<ul>
<li>Only tests the JS class not the component</li>
<li>Mostly used for services and pipes</li>
<li>Need to create instances of classes on your own</li>
</ul>

  </div>
  
  <div class="flex-even markdown-inner">
    <h4 id="integrated">
  Integrated
  <a class="anchor" href="#integrated">#</a>
</h4>
<ul>
<li>Tests the class and template together</li>
<li>Mostly used for components and directives</li>
<li>The objects are created by the framework</li>
</ul>

  </div>
  
</div>

<h2 id="unit-tests">
  Unit tests
  <a class="anchor" href="#unit-tests">#</a>
</h2>
<p>They test a single unit (like a class, function, or a bunch of classes) in isolation. Some features of unit tests:</p>
<ul>
<li>Fast (to code and to execute)</li>
<li>Should handle one state change at max</li>
<li>Assert one thing</li>
<li>Minimal dependencies</li>
</ul>
<p>They follow a structure of:</p>
<ul>
<li>Assemble - The setup code for the test</li>
<li>Action - The thing that the user will likely do. Can be a state change</li>
<li>Assert - &ldquo;Is the result what is expected?&rdquo;</li>
</ul>
<p>Run unit tests with <code>ng test</code> which asks Karma to look for *.spec.ts files and execute the tests within them.
A basic test looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#39;a nice test&#39;</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">beforeEach</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// code to run before each &#39;it&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#39;exact test stuff&#39;</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// do something
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">expected</span>(<span style="color:#a6e22e">valA</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#39;good stuff&#39;</span>);
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><blockquote class="book-hint info">
  <code>toBe</code> is just one of the many &ldquo;matchers&rdquo; jasmine has. The official docs has 
  <a href="https://jasmine.github.io/api/4.0/matchers">a list of matchers</a>
</blockquote>

<h3 id="mocking">
  Mocking
  <a class="anchor" href="#mocking">#</a>
</h3>
<p>To minimize depedencies on external code they are <strong>mocked</strong> for things like network calls, DB use, side effects etc. E.g. instead of making HTTP requests with the http dependency use a mock http dependency that simulates network calls and returns results immediately.</p>
<ul>
<li>Mock with jasmine like this: <code>const mockStuff jasmine.createSpyObj('some desc', ['method1', 'method2', 'method3'])</code>.</li>
<li>A particular method can be modified to return a particular value like this: <code>mockStuff.method1.and.returnValue(anyValue)</code></li>
<li>To check if a method is being called in the function with particular params, use: <code>expect(mockStuff.method2).toHaveBeenCalledWith(param1, param2)</code> where the parameters can be exact values or it can just check that the types match by passing in an arg like <code>jasmine.any(ClassName)</code></li>
<li>Components can be tested just like services for isolated tests. Instantiate the class with mock dependencies, set any input params and then test whatever methods needed to be tested.</li>
</ul>
<h2 id="integrated-tests">
  Integrated tests
  <a class="anchor" href="#integrated-tests">#</a>
</h2>
<p>They&rsquo;re more complex and are meant to test an entire functionality. It can test the template and the component in an environment that&rsquo;s a close approximation to real world usage.</p>
<h3 id="setup">
  Setup
  <a class="anchor" href="#setup">#</a>
</h3>
<p>This is more complex since Angular creates the instances of the component and template and places them in a module. This setup goes in a <code>beforeEach</code>. The code for this is usually generated by the cli when using <code>ng g c</code> and is placed in &ldquo;*.component.spec.ts&rdquo;. It looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// inside a describe callback
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">component</span>: <span style="color:#66d9ef">NiceComponent</span>; <span style="color:#75715e">// the type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">fixture</span>: <span style="color:#66d9ef">ComponentFixture</span>&lt;<span style="color:#f92672">NiceComponent</span>&gt;; <span style="color:#75715e">// from &#34;@angular/core/testing&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">debugEl</span>: <span style="color:#66d9ef">DebugElement</span>; <span style="color:#75715e">// handle to the template
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">rawHTML</span>: <span style="color:#66d9ef">HTMLElement</span>; <span style="color:#75715e">// handle to the raw html of the template
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">mockThatService</span>; <span style="color:#75715e">// mock object for a dependency
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">beforeEach</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// if you don&#39;t want complex functionality no need to use a spyObj
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// a simple object with the props required will do
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">mockThatService</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// creates the module where the component will run
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">configureTestingModule</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">declarations</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">component</span>
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>            { <span style="color:#a6e22e">provide</span>: <span style="color:#66d9ef">ThatService</span>, <span style="color:#a6e22e">useValue</span>: <span style="color:#66d9ef">mockThatService</span> }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fixture</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">createComponent</span>(<span style="color:#a6e22e">NiceComponent</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">component</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">componentInstance</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">debugEl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">debugElement</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rawHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">nativeElement</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// runs change detection so the template is kept updated with the component
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fixture</span>.<span style="color:#a6e22e">detectChanges</span>();
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><h3 id="deep--shallow-tests">
  Deep &amp; Shallow tests
  <a class="anchor" href="#deep--shallow-tests">#</a>
</h3>
<p>A shallow integration test just includes the component that is being tested while a deep test will also include the necessary children component (but may not test them).
A deep test is heavy because of dependencies but it is complete.</p>
<p>When using a shallow test, it is possible to ignore the errors caused by dependencies on other components.
This is done by adding a <strong>schema</strong> to the testing module like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">configureTestingModule</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">declarations</span><span style="color:#f92672">:</span> [<span style="color:#75715e">/* wtv */</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [<span style="color:#75715e">/* wtv */</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">schemas</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">NO_ERRORS_SCHEMA</span> <span style="color:#75715e">// from angular core
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    ]
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><h1 id="debugging">
  Debugging
  <a class="anchor" href="#debugging">#</a>
</h1>
<p>This can be a pain. Here are some tools to help:</p>
<ul>
<li>
  <a href="https://augury.rangle.io/">Augury</a> can present info neatly in dev tools.</li>
<li>
  <a href="https://www.npmjs.com/package/ngx-logger">ngx-logger</a> is a nice logger apparently.</li>
<li>Put <code>debugger</code> in your TS code so it can be paused in the browser.</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#unit--integrated-tests">Unit &amp; Integrated tests</a>
      <ul>
        <li><a href="#unit-tests">Unit tests</a>
          <ul>
            <li><a href="#mocking">Mocking</a></li>
          </ul>
        </li>
        <li><a href="#integrated-tests">Integrated tests</a>
          <ul>
            <li><a href="#setup">Setup</a></li>
            <li><a href="#deep--shallow-tests">Deep &amp; Shallow tests</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#debugging">Debugging</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>

</html>












